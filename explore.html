<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Explore</title>
<style>
html, body {
    height: 100%;
    margin: 0;
    font-family: sans-serif;
    background-color: #97f7df;
}

/* Main flex container */
#app {
    height: 100%;
    display: flex;
    flex-direction: column;
}

#notes-area {
    flex: 1;
    position: relative; 
    z-index: 1;
}

#refresh-area {
    display: flex;
    justify-content: center;
    padding: 16px;
    position: relative;
    z-index: 10;
}

#home-area {
    display: flex;
    justify-content: center;
    padding-bottom: 24px;
}

/* Buttons */
button {
    padding: 12px 24px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    pointer-events: auto;
}

/* Spore styling */
.spore {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 12px;
    border-radius: 50%;
    background: white;
    position: absolute;
    text-align: center;
    word-break: break-word;
    overflow: auto;
    pointer-events: none;
    min-width: 80px;   /* minimum size */
    min-height: 80px;
    max-width: 220px;  /* maximum size */
    max-height: 220px;
    font-size: 16px;
}


</style>
</head>
<body>

<div id="app">

    <!-- FLEXBOX 1: Notes -->
    <div id="notes-area"></div>

    <!-- FLEXBOX 2: Refresh -->
    <div id="refresh-area">
        <button id="refreshBtn" onclick="renderSpores()">Fetch Spores</button>
    </div>

    <!-- FLEXBOX 3: Home -->
    <div id="home-area">
        <a href="index.html"><button id="homeBtn">Back to Home</button></a>
    </div>

</div>

<script>
//non-overlapping randomization and linking to google sheets aided by ChatGPT

const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS37DTdx0KPmZux76Okyng73w8bmBVQ87TEkO5Bw7ntfZleFjj11FZYHmlmK474Grb2pWYwt9tfMDhV/pub?output=csv";

// ENTRY IDs
const NOTE_ENTRY_ID = "Your note";

let notes = [];

// Load CSV and extract notes by entry ID
async function loadNotes() {
    const res = await fetch(CSV_URL);
    const text = await res.text();

    const rows = text.split("\n");
    let headers = rows[0].split(",").map(h => h.replace(/^"|"$/g, "").trim());

    const noteIndex = headers.indexOf(NOTE_ENTRY_ID);
    if (noteIndex === -1) {
        console.error("Note entry ID not found:", NOTE_ENTRY_ID);
        return;
    }

    notes = rows.slice(1)
        .map(r => r.split(",")[noteIndex])
        .filter(Boolean);
}

function isOverlapping(newSpore, placedSpores) {
    for (let sp of placedSpores) {
        const dx = newSpore.x - sp.x;
        const dy = newSpore.y - sp.y;
        const distance = Math.sqrt(dx*dx + dy*dy);
        const minDistance = (newSpore.size + sp.size) / 2;
        if (distance < minDistance) return true;
    }
    return false;
}


function renderSpores() {
    const notesArea = document.getElementById("notes-area");
    notesArea.innerHTML = "";

    if (notes.length === 0) return;

    const shuffled = [...notes].sort(() => 0.5 - Math.random());
    const selected = shuffled.slice(0, Math.min(5, notes.length));

    const placedSpores = [];

    selected.forEach(note => {
    const spore = document.createElement("div");
    spore.className = "spore";
    spore.textContent = note;

    // Approximate width by text length
    const baseSize = 80;            // min size
    const extraSize = Math.min(note.length * 6, 140); // scale with text length, capped
    const sporeSize = baseSize + extraSize;

    spore.style.width = spore.style.height = sporeSize + "px";

    const maxX = notesArea.clientWidth - sporeSize;
    const maxY = notesArea.clientHeight - sporeSize;

    let x, y, attempts = 0;
    do {
        x = Math.random() * maxX;
        y = Math.random() * maxY;
        attempts++;
        if (attempts > 100) break; // fail-safe
    } while (isOverlapping({x, y, size: sporeSize}, placedSpores));

    spore.style.left = x + "px";
    spore.style.top  = y + "px";

    notesArea.appendChild(spore);
    placedSpores.push({x, y, size: sporeSize});
});

}

// Initial load
loadNotes().then(renderSpores);

// Refresh button
document.getElementById("refreshBtn").addEventListener("click", renderSpores);

// Optional: re-randomize on resize
window.addEventListener("resize", renderSpores);
</script>

</body>
</html>
