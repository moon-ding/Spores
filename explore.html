<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Explore</title>
<style>
@font-face{
    font-family: QueshaGndR;
    src:url(fonts/Quesha-gndR.ttf);
}

html, body {
    height: 100%;
    margin: 0;
    font-family: sans-serif;
    background-color: #97f7df;
    font-family: 'Times New Roman', Times, serif;
}

/* Main flex container */
#app {
    height: 100%;
    display: flex;
    flex-direction: column;
}

#notes-area {
    flex: 1;
    position: relative; 
    z-index: 1;
}

/* Buttons */
button{
    border-radius: 12px;
    border: none;
    padding: 12px 32px;
    background-color: #22b393;
    cursor: pointer;
    transition: all 0.1s ease-in-out;
    font-family: QueshaGndR;
    font-size: large;
}

button:hover{
    background-color: #97f7df;
    letter-spacing: 0.1em;
}

/* has() state helped by ChatGPT */
body:has(button:hover){
    background-color: #22b393;
    transition: all 0.25s ease-in-out;
}

#refresh-button{
    position: fixed;
    bottom: 24px;
    left:50%;
    z-index: 20;
    transform: translateX(-50%);
    font-size: xx-large;
    padding: 18px 48px;
    border-radius: 18px;
}

#home-button {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 20;
}

/* Spore styling */
.spore {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 12px;
    border-radius: 50% 55% 45% 50% / 52% 48% 50% 50%;
    background: white;
    position: absolute;
    text-align: center;
    word-break: break-word;
    overflow: auto;
    min-width: 80px;   /* minimum size */
    min-height: 80px;
    max-width: 220px;  /* maximum size */
    max-height: 220px;
    font-size: 16px;
    cursor: pointer;
}

.spore:hover{
    border:2px ridge 	#45797a;
    transition: border 0.1s ease-in-out;
    z-index: 5;
}

.spore.liked{
    animation: spore-flash 0.5s ease;
}

@keyframes spore-flash {
    0%{
        background-color: white;
        transform: scale(1);
    }
    50%{
        background-color: #45797a;
        transform: scale(1.15);
    }
    100%{
        background-color: white;
        transform: scale(1);
    }
}

/*new stuff*/
.spore-text {
    margin-bottom: 8px;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

.spore-likes {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-size: 14px;
    color: #45797a; /* heart-like color */
}

.resonance-icon {pointer-events: none;}

</style>
</head>
<body>

<div id="app">
    <div id="notes-area"></div>

    <div class="button-row">
        <button id="refresh-button" onclick="renderSpores()">Fetch Spores</button></div>
        <a href="index.html"><button id="home-button">Back to Home</button></a></div>
</div>

<script>
/*
ChatGPT aided parts:
linking google sheets user responses
spore spawning randomization mechanism
debugging
*/

const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS37DTdx0KPmZux76Okyng73w8bmBVQ87TEkO5Bw7ntfZleFjj11FZYHmlmK474Grb2pWYwt9tfMDhV/pub?output=csv";

// ENTRY ID
const NOTE_ENTRY_ID = "Your note";

let notes = [];

// Load CSV and extract notes by entry ID
async function loadNotes() {
    const res = await fetch(CSV_URL);
    const text = await res.text();

    const rows = text.split("\n");
    let headers = rows[0].split(",").map(h => h.replace(/^"|"$/g, "").trim());

    const noteIndex = headers.indexOf(NOTE_ENTRY_ID);
    if (noteIndex === -1) {
        console.error("Note entry ID not found:", NOTE_ENTRY_ID);
        return;
    }

    notes = rows.slice(1)
        .map(r => r.split(",")[noteIndex])
        .filter(Boolean);
}

function isOverlapping(newSpore, placedSpores) {
    for (let sp of placedSpores) {
        const dx = newSpore.x - sp.x;
        const dy = newSpore.y - sp.y;
        const distance = Math.sqrt(dx*dx + dy*dy);
        const minDistance = (newSpore.size + sp.size) / 2;
        if (distance < minDistance) return true;
    }
    return false;
}


function renderSpores() {
    const notesArea = document.getElementById("notes-area");
    notesArea.innerHTML = "";

    if (notes.length === 0) return;

    const shuffled = [...notes].sort(() => 0.5 - Math.random());
    const selected = shuffled.slice(0, Math.min(5, notes.length));

    const placedSpores = [];

selected.forEach(note => {
        const spore = document.createElement("div");
        spore.className = "spore";

        // Text
        const sporeText = document.createElement("div");
        sporeText.className = "spore-text";
        sporeText.textContent = note;

        // Likes
        const sporeLikes = document.createElement("div");
        sporeLikes.className = "spore-likes";

        const icon = document.createElement("span");
        icon.className = "resonance-icon";
        icon.textContent = "âŸ¡";

        const count = document.createElement("span");
        count.className = "like-count";
        count.textContent = "0";

        sporeLikes.appendChild(icon);
        sporeLikes.appendChild(count);

        spore.appendChild(sporeText);
        spore.appendChild(sporeLikes);

        // Position & size
        const baseSize = 80;
        const extraSize = Math.min(note.length * 6, 140);
        const sporeSize = baseSize + extraSize;
        spore.style.width = spore.style.height = sporeSize + "px";

        const maxX = notesArea.clientWidth - sporeSize;
        const maxY = notesArea.clientHeight - sporeSize;

        let x, y, attempts = 0;
        do {
            x = Math.random() * maxX;
            y = Math.random() * maxY;
            attempts++;
            if (attempts > 100) break;
        } while (isOverlapping({x, y, size: sporeSize}, placedSpores));

        spore.style.left = x + "px";
        spore.style.top = y + "px";

        // CLICK event for icon
        spore.addEventListener("click", () => {
            count.textContent = parseInt(count.textContent) + 1;

            // Flash animation
            spore.classList.remove("liked");
            void spore.offsetWidth; // force reflow
            spore.classList.add("liked");
        });

        notesArea.appendChild(spore);
        placedSpores.push({x, y, size: sporeSize});
    });
}


// Initial load
loadNotes().then(renderSpores);

// Refresh button
document.getElementById("refresh-button").addEventListener("click", renderSpores);

// Optional: re-randomize on resize
window.addEventListener("resize", renderSpores);

</script>

</body>
</html>
